# Java åç«¯é‡è¿”å·¥ä½œè¯¦ç»†å­¦ä¹ è®¡åˆ’ - Day 1

> **ç›®æ ‡**ï¼šå…¨é¢å¤è‹ Java è¯­æ„Ÿï¼ŒæŒæ¡ä» Java 8 åˆ° Java 17 çš„æ ¸å¿ƒè¯­æ³•æ¼”è¿›ï¼Œå¹¶é‡æ¸©é«˜å¹¶å‘ç¼–ç¨‹çš„"æ·±æ°´åŒº"ä¸é¿å‘æŒ‡å—ã€‚

## â˜€ï¸ ä¸Šåˆï¼ˆ3å°æ—¶ï¼‰ï¼šJava ç°ä»£è¯­æ³•æ ¸å¿ƒ (Java 8-17)

### 1. Lambda è¡¨è¾¾å¼ä¸å‡½æ•°å¼æ¥å£

**æ ¸å¿ƒæ¦‚å¿µ**ï¼šLambda æ˜¯åŒ¿åå†…éƒ¨ç±»çš„è¯­æ³•ç³–ï¼Œæ—¨åœ¨å°†"è¡Œä¸º"ä½œä¸ºå‚æ•°ä¼ é€’ã€‚

**è¯­æ³•**ï¼š`(å‚æ•°) -> { é€»è¾‘ }`

::: tip æ ¸å¿ƒè®°å¿†ï¼šå››å¤§å†…ç½®å‡½æ•°å¼æ¥å£
åœ¨ `java.util.function` åŒ…ä¸‹ï¼Œæ­»è®°è¿™å››ä¸ªï¼Œæ¶µç›– 90% åœºæ™¯ï¼š

| æ¥å£ | æŠ½è±¡æ–¹æ³• | å‚æ•° | è¿”å›å€¼ | å…¸å‹ç”¨é€” |
| :--- | :--- | :--- | :--- | :--- |
| `Function<T, R>` | `R apply(T t)` | T | R | ç±»å‹è½¬æ¢ (Entity -> DTO) |
| `Predicate<T>` | `boolean test(T t)` | T | boolean | è¿‡æ»¤åˆ¤æ–­ (Filter) |
| `Consumer<T>` | `void accept(T t)` | T | void | æ¶ˆè´¹æ•°æ® (æ‰“å°ã€å†™å…¥æ•°æ®åº“) |
| `Supplier<T>` | `T get()` | æ—  | T | å·¥å‚æ–¹æ³•ã€æ‡’åŠ è½½ |
:::

### 2. Stream API (å£°æ˜å¼å¤„ç†)

Stream æ˜¯å¤„ç†é›†åˆï¼ˆCollectionï¼‰çš„ç¥å™¨ã€‚

**æ“ä½œæµç¨‹**ï¼š`Source` (é›†åˆ) -> `Intermediate` (ä¸­é—´æ“ä½œ: map/filter) -> `Terminal` (ç»ˆæ­¢æ“ä½œ: collect/forEach)ã€‚

#### ğŸ”¥ é«˜é¢‘æ“ä½œé€ŸæŸ¥

```java
List<Integer> numbers = Arrays.asList(1, 2, 3, 4, 5);

// 1. è¿‡æ»¤ä¸æ˜ å°„
List<Integer> squares = numbers.stream()
    .filter(n -> n % 2 == 0) // è°“è¯ï¼šä¿ç•™å¶æ•°
    .map(n -> n * n)         // è½¬æ¢ï¼šæ±‚å¹³æ–¹
    .collect(Collectors.toList());

// 2. ç»Ÿè®¡ (IntStream)
IntSummaryStatistics stats = numbers.stream()
    .mapToInt(x -> x)
    .summaryStatistics();
System.out.println("Max: " + stats.getMax()); // è¾“å‡ºæœ€å¤§å€¼
System.out.println("Avg: " + stats.getAverage()); // è¾“å‡ºå¹³å‡å€¼
```

#### ğŸ’¡ å®æˆ˜è¿›é˜¶ï¼šåˆ†ç»„ä¸è½¬ Map

è¿™æ˜¯é¢è¯•å’Œå·¥ä½œä¸­æå…¶é«˜é¢‘çš„åœºæ™¯ã€‚

```java
// å‡è®¾æœ‰ä¸€ä¸ª User å¯¹è±¡åˆ—è¡¨
List<User> users = getUsers();

// åœºæ™¯ A: æŒ‰éƒ¨é—¨åˆ†ç»„ (Map<String, List<User>>)
Map<String, List<User>> byDept = users.stream()
    .collect(Collectors.groupingBy(User::getDepartment));

// åœºæ™¯ B: List è½¬ Map (id -> User)ï¼Œæ³¨æ„å¤„ç† Key é‡å¤
Map<Long, User> idMap = users.stream()
    .collect(Collectors.toMap(
        User::getId, 
        Function.identity(), 
        (oldVal, newVal) -> newVal // å¦‚æœ Key é‡å¤ï¼Œä¿ç•™æ–°å€¼
    ));
```

### 3. Optional ä¸ Map å¢å¼º (é¿å…ç©ºæŒ‡é’ˆ)

#### Optional æœ€ä½³å®è·µ

::: warning é¿å‘æŒ‡å—
æ°¸è¿œä¸è¦ç›´æ¥è°ƒç”¨ `Optional.get()`ï¼Œå¦åˆ™å’Œå†™ `if (obj != null)` æ²¡åŒºåˆ«ï¼Œç”šè‡³æŠ›å‡º `NoSuchElementException`ã€‚
:::

```java
// æ­£ç¡®å§¿åŠ¿ï¼š
User user = findUserById(1); // å¯èƒ½è¿”å› null
Optional<User> opt = Optional.ofNullable(user);

// 1. å­˜åœ¨åˆ™æ‰“å°
opt.ifPresent(u -> System.out.println(u.getName()));

// 2. å­˜åœ¨åˆ™è½¬æ¢ï¼Œä¸å­˜åœ¨åˆ™è¿”å›é»˜è®¤å€¼
String name = opt.map(User::getName).orElse("Unknown");

// 3. ä¸å­˜åœ¨åˆ™æŠ›å‡ºå¼‚å¸¸
User validUser = opt.orElseThrow(() -> new RuntimeException("User not found"));
```

#### Map æ–°ç‰¹æ€§ (Java 8)

`computeIfAbsent`ï¼šæ„å»ºæœ¬åœ°ç¼“å­˜çš„ç¥å™¨ã€‚

```java
Map<String, List<String>> cache = new HashMap<>();
// å¦‚æœ "Java" è¿™ä¸ª key ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–° List æ”¾å…¥ï¼Œå¹¶è¿”å›è¯¥ List
cache.computeIfAbsent("Java", k -> new ArrayList<>()).add("SpringBoot");
```

### 4. æ–°æ—¥æœŸæ—¶é—´ API (Java Time)

å½»åº•æŠ›å¼ƒ `java.util.Date` å’Œ `SimpleDateFormat`ã€‚

- **LocalDateTime**: ä¸å¸¦æ—¶åŒºçš„æ—¥æœŸæ—¶é—´ã€‚
- **ZonedDateTime**: å¸¦æ—¶åŒºçš„æ—¥æœŸæ—¶é—´ã€‚
- **DateTimeFormatter**: çº¿ç¨‹å®‰å…¨çš„æ ¼å¼åŒ–å™¨ã€‚

```java
// è·å–å½“å‰æ—¶é—´
LocalDateTime now = LocalDateTime.now();
// æ ¼å¼åŒ–
String s = now.format(DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss"));
// è®¡ç®—æ—¶é—´å·®
LocalDateTime taskTime = LocalDateTime.of(2025, 11, 11, 10, 0);
long days = ChronoUnit.DAYS.between(now, taskTime);
```

## ğŸŒ¤ï¸ ä¸‹åˆï¼ˆ3å°æ—¶ï¼‰ï¼šJava å¹¶å‘ç¼–ç¨‹å¤ä¹ 

### 1. åŸºç¡€å…³é”®å­—å›é¡¾

| å…³é”®å­— | ä½œç”¨ | å…³é”®ç‚¹ |
| :--- | :--- | :--- |
| `synchronized` | ä¿è¯åŸå­æ€§ã€å¯è§æ€§ | é”å‡çº§æœºåˆ¶ï¼ˆåå‘é”->è½»é‡çº§é”->é‡é‡çº§é”ï¼‰ï¼Œå¯ä¿®é¥°æ–¹æ³•æˆ–ä»£ç å—ã€‚ |
| `volatile` | ä¿è¯å¯è§æ€§ã€ç¦æ­¢æŒ‡ä»¤é‡æ’ | ä¸ä¿è¯åŸå­æ€§ã€‚å¸¸ç”¨äºçŠ¶æ€æ ‡è®°é‡ã€å•ä¾‹æ¨¡å¼åŒé‡æ£€æŸ¥é”ã€‚ |

### 2. çº¿ç¨‹æ±  (ThreadPoolExecutor) [é‡ä¸­ä¹‹é‡]

::: danger é˜¿é‡Œå·´å·´å¼€å‘è§„èŒƒ
ç¦æ­¢ä½¿ç”¨ `Executors.newFixedThreadPool()` æˆ– `newCachedThreadPool()` åˆ›å»ºçº¿ç¨‹æ± ã€‚

**åŸå› **ï¼šå…è®¸çš„è¯·æ±‚é˜Ÿåˆ—é•¿åº¦ä¸º `Integer.MAX_VALUE`ï¼Œå¯èƒ½å †ç§¯å¤§é‡è¯·æ±‚ï¼Œå¯¼è‡´ OOM (Out Of Memory)ã€‚
:::

#### æ ‡å‡†åˆ›å»ºæ–¹å¼

```java
ThreadPoolExecutor executor = new ThreadPoolExecutor(
    2,                               // corePoolSize: æ ¸å¿ƒçº¿ç¨‹æ•°ï¼ˆå¸¸é©»ï¼‰
    5,                               // maximumPoolSize: æœ€å¤§çº¿ç¨‹æ•°ï¼ˆæ•‘æ€¥ç”¨ï¼‰
    60, TimeUnit.SECONDS,            // keepAliveTime: æ•‘æ€¥çº¿ç¨‹ç©ºé—²å­˜æ´»æ—¶é—´
    new LinkedBlockingQueue<>(100),  // workQueue: é˜»å¡é˜Ÿåˆ—ï¼ˆå¿…é¡»è¦è®¾ç½®å®¹é‡ï¼ï¼‰
    Executors.defaultThreadFactory(),// threadFactory: çº¿ç¨‹å·¥å‚ï¼ˆå»ºè®®è‡ªå®šä¹‰åç§°æ–¹ä¾¿æ’æŸ¥ï¼‰
    new ThreadPoolExecutor.CallerRunsPolicy() // handler: æ‹’ç»ç­–ç•¥ï¼ˆé˜Ÿåˆ—æ»¡äº†è°æ¥å¹²ï¼Ÿï¼‰
);

// CallerRunsPolicy: ç”±æäº¤ä»»åŠ¡çš„çº¿ç¨‹è‡ªå·±å»æ‰§è¡Œè¯¥ä»»åŠ¡ï¼ˆä¸€ç§ç¼“å’Œçš„é™çº§ç­–ç•¥ï¼‰
```

### 3. CompletableFuture (å¼‚æ­¥ç¼–æ’)

Java 8 å¼•å…¥çš„å¼‚æ­¥ç¼–ç¨‹ç¥å™¨ï¼Œè§£å†³äº† `Future.get()` é˜»å¡çš„é—®é¢˜ã€‚

**åœºæ™¯**ï¼šæŸ¥è¯¢å•†å“è¯¦æƒ…ï¼ˆåŒæ—¶æŸ¥åŸºæœ¬ä¿¡æ¯ã€åº“å­˜ã€å›¾ç‰‡ï¼Œä¸‰è€…å¹¶è¡Œï¼Œå…¨éƒ¨å®Œæˆåè¿”å›ï¼‰ã€‚

```java
// 1. å¼‚æ­¥ä»»åŠ¡ A
CompletableFuture<String> taskA = CompletableFuture.supplyAsync(() -> {
    return "åŸºæœ¬ä¿¡æ¯";
});

// 2. å¼‚æ­¥ä»»åŠ¡ B
CompletableFuture<String> taskB = CompletableFuture.supplyAsync(() -> {
    return "åº“å­˜ä¿¡æ¯";
});

// 3. ç»„åˆç»“æœ
CompletableFuture<Void> allTasks = CompletableFuture.allOf(taskA, taskB);

// 4. ç­‰å¾…æ‰€æœ‰å®Œæˆå¹¶å¤„ç†
allTasks.thenRun(() -> {
    try {
        System.out.println(taskA.get() + " & " + taskB.get());
    } catch (Exception e) { e.printStackTrace(); }
}).join();
```

### 4. å¹¶å‘é›†åˆä¸åŸå­ç±»

- **ConcurrentHashMap**: å¿…é¡»è¦æ‡‚åŸç†ï¼ˆCAS + synchronizedï¼ŒèŠ‚ç‚¹ä¸Šé”ï¼‰ã€‚
- **AtomicInteger**: åŸºäº CAS (Compare And Swap) å®ç°æ— é”è‡ªå¢ï¼Œé€‚åˆåšè®¡æ•°å™¨ã€‚

## ğŸŒ™ æ™šä¸Šï¼ˆ2å°æ—¶ï¼‰ï¼šJava 17+ æ–°ç‰¹æ€§ (LTS)

Java 17 æ˜¯ç›®å‰ä¸»æµçš„ LTS ç‰ˆæœ¬ï¼Œå¾ˆå¤šæ¡†æ¶ï¼ˆå¦‚ Spring Boot 3ï¼‰å·²å¼ºåˆ¶è¦æ±‚ Java 17ã€‚

### 1. Record (è®°å½•ç±»)

**æ¦‚å¿µ**ï¼šä¸“é—¨ç”¨äºæ‰¿è½½æ•°æ®çš„ä¸å¯å˜ç±»ï¼ˆData Carrierï¼‰ï¼Œè‡ªåŠ¨ç”Ÿæˆ getterã€equalsã€hashCodeã€toStringã€‚

**åœºæ™¯**ï¼šDTO, VO, é…ç½®ç±»ã€‚

```java
// å®šä¹‰
public record Person(String name, int age) {}

// ä½¿ç”¨
Person p = new Person("Alice", 25);
System.out.println(p.name()); // æ³¨æ„ï¼šæ˜¯ name() ä¸æ˜¯ getName()
```

### 2. Switch Expressions (å¢å¼ºç‰ˆ Switch)

æ”¯æŒç®­å¤´è¯­æ³•ï¼Œä¸å†éœ€è¦ breakï¼Œä¸”å¯ä»¥ä½œä¸ºè¡¨è¾¾å¼è¿”å›å€¼ã€‚

```java
String dayType = switch (day) {
    case MONDAY, FRIDAY -> "Working Day";
    case SUNDAY -> "Weekend";
    default -> {
        System.out.println("Checking...");
        yield "Unknown"; // ä»£ç å—ä¸­ä½¿ç”¨ yield è¿”å›
    }
};
```

### 3. Text Blocks (æ–‡æœ¬å—)

ç”¨ `"""` åŒ…è£¹ï¼ŒåŸç”Ÿæ”¯æŒå¤šè¡Œå­—ç¬¦ä¸²ï¼Œå†™ SQL å’Œ JSON æå…¶èˆ’æœã€‚

```java
String json = """
    {
        "name": "Alice",
        "role": "Admin"
    }
    """;
```

### 4. Pattern Matching (æ¨¡å¼åŒ¹é…)

instanceof æ¨¡å¼åŒ¹é…çœå»äº†å¼ºåˆ¶ç±»å‹è½¬æ¢çš„æ­¥éª¤ã€‚

```java
Object obj = "Hello Java 17";

// æ—§å†™æ³•
if (obj instanceof String) {
    String s = (String) obj;
    System.out.println(s.length());
}

// æ–°å†™æ³• (Java 16+)
if (obj instanceof String s) {
    System.out.println(s.length()); // s ç›´æ¥å¯ç”¨
}
```

## ğŸ“ Day 1 æ€»ç»“ä¸è‡ªæˆ‘æ£€æµ‹

è¯·å°è¯•å›ç­”ä»¥ä¸‹é—®é¢˜ï¼Œæ£€éªŒä»Šæ—¥å­¦ä¹ æˆæœï¼š

1. **[Stream]** `map` å’Œ `flatMap` æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ
2. **[Thread]** ä¸ºä»€ä¹ˆ `ThreadLocal` å®¹æ˜“å¯¼è‡´å†…å­˜æ³„æ¼ï¼ŸåŠ¡å¿…åœ¨ä½¿ç”¨å®Œåè°ƒç”¨ä»€ä¹ˆæ–¹æ³•ï¼Ÿ
3. **[Thread]** çº¿ç¨‹æ± çš„ `corePoolSize` å’Œ `maximumPoolSize` åœ¨ä»»åŠ¡æäº¤æ—¶çš„è§¦å‘é¡ºåºæ˜¯æ€æ ·çš„ï¼Ÿï¼ˆå…³é”®ï¼šå…ˆæ ¸å¿ƒï¼Œå†é˜Ÿåˆ—,æœ€åæœ€å¤§ï¼‰
4. **[Java 17]** ä»€ä¹ˆæ—¶å€™åº”è¯¥ç”¨ `record` ä»£æ›¿ `class`ï¼Ÿ

::: info ä¸‹ä¸€æ­¥è¡ŒåŠ¨
å¦‚æœ Day 1 æ„Ÿè§‰è‰¯å¥½ï¼ŒDay 2 æˆ‘ä»¬å°†è¿›å…¥ **Spring Boot 3 ä¸ Spring Cloud æ ¸å¿ƒç»„ä»¶** çš„å¤ä¹ ã€‚
:::