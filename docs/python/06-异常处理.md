# âš ï¸ Python å¼‚å¸¸å¤„ç†

## å¼‚å¸¸å¤„ç†æ¦‚è¿°

å¼‚å¸¸å¤„ç†æ˜¯ç¼–ç¨‹ä¸­å¤„ç†é”™è¯¯å’Œå¼‚å¸¸æƒ…å†µçš„é‡è¦æœºåˆ¶ã€‚Python æä¾›äº†å¼ºå¤§çš„å¼‚å¸¸å¤„ç†ç³»ç»Ÿï¼Œè®©ç¨‹åºèƒ½å¤Ÿä¼˜é›…åœ°å¤„ç†å„ç§é”™è¯¯æƒ…å†µã€‚

<div style="background: #e3f2fd; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
  <strong>ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦å¼‚å¸¸å¤„ç†ï¼Ÿ</strong>ï¼š
  - æé«˜ç¨‹åºå¥å£®æ€§ï¼šç¨‹åºä¸ä¼šå› ä¸ºé”™è¯¯è€Œå´©æºƒ
  - æä¾›é”™è¯¯ä¿¡æ¯ï¼šå¸®åŠ©å¼€å‘è€…å®šä½å’Œè§£å†³é—®é¢˜
  - ä¼˜é›…é™çº§ï¼šåœ¨é”™è¯¯å‘ç”Ÿæ—¶æä¾›å¤‡ç”¨æ–¹æ¡ˆ
  - ç”¨æˆ·ä½“éªŒï¼šç»™ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º
</div>

## ğŸš¨ å¼‚å¸¸ç±»å‹

### å¸¸è§å†…ç½®å¼‚å¸¸

```python
# é™¤é›¶é”™è¯¯
try:
    result = 10 / 0
except ZeroDivisionError as e:
    print(f"é™¤é›¶é”™è¯¯: {e}")

# ç±»å‹é”™è¯¯
try:
    result = "hello" + 5
except TypeError as e:
    print(f"ç±»å‹é”™è¯¯: {e}")

# å€¼é”™è¯¯
try:
    number = int("abc")
except ValueError as e:
    print(f"å€¼é”™è¯¯: {e}")

# ç´¢å¼•é”™è¯¯
try:
    numbers = [1, 2, 3]
    print(numbers[10])
except IndexError as e:
    print(f"ç´¢å¼•é”™è¯¯: {e}")

# é”®é”™è¯¯
try:
    person = {"name": "å¼ ä¸‰"}
    print(person["age"])
except KeyError as e:
    print(f"é”®é”™è¯¯: {e}")

# æ–‡ä»¶ä¸å­˜åœ¨é”™è¯¯
try:
    with open("ä¸å­˜åœ¨çš„æ–‡ä»¶.txt", "r") as f:
        content = f.read()
except FileNotFoundError as e:
    print(f"æ–‡ä»¶ä¸å­˜åœ¨: {e}")
```

### å¼‚å¸¸å±‚æ¬¡ç»“æ„

```python
# æŸ¥çœ‹å¼‚å¸¸å±‚æ¬¡ç»“æ„
import builtins

def print_exception_hierarchy(exception_class, indent=0):
    """æ‰“å°å¼‚å¸¸å±‚æ¬¡ç»“æ„"""
    print("  " * indent + exception_class.__name__)
    for subclass in exception_class.__subclasses__():
        print_exception_hierarchy(subclass, indent + 1)

# æ‰“å°ä¸»è¦å¼‚å¸¸å±‚æ¬¡
print("Python å¼‚å¸¸å±‚æ¬¡ç»“æ„:")
print_exception_hierarchy(BaseException)
```

## ğŸ›¡ï¸ try-except è¯­å¥

### åŸºæœ¬å¼‚å¸¸å¤„ç†

```python
def safe_divide(a, b):
    """å®‰å…¨é™¤æ³•å‡½æ•°"""
    try:
        result = a / b
        return result
    except ZeroDivisionError:
        print("é”™è¯¯ï¼šé™¤æ•°ä¸èƒ½ä¸ºé›¶")
        return None
    except TypeError:
        print("é”™è¯¯ï¼šå‚æ•°ç±»å‹ä¸æ­£ç¡®")
        return None

# æµ‹è¯•å¼‚å¸¸å¤„ç†
print(safe_divide(10, 2))    # æ­£å¸¸æƒ…å†µ
print(safe_divide(10, 0))    # é™¤é›¶é”™è¯¯
print(safe_divide(10, "2"))  # ç±»å‹é”™è¯¯
```

### å¤šä¸ªå¼‚å¸¸å¤„ç†

```python
def process_user_input(user_input):
    """å¤„ç†ç”¨æˆ·è¾“å…¥"""
    try:
        # å°è¯•è½¬æ¢ä¸ºæ•´æ•°
        number = int(user_input)
        # å°è¯•è®¡ç®—å¹³æ–¹æ ¹
        import math
        result = math.sqrt(number)
        return f"âˆš{number} = {result:.2f}"
    
    except ValueError:
        return "é”™è¯¯ï¼šè¯·è¾“å…¥æœ‰æ•ˆçš„æ•°å­—"
    
    except TypeError:
        return "é”™è¯¯ï¼šè¾“å…¥ç±»å‹ä¸æ­£ç¡®"
    
    except Exception as e:
        return f"æœªçŸ¥é”™è¯¯ï¼š{e}"

# æµ‹è¯•å¤šç§æƒ…å†µ
test_inputs = ["16", "abc", "-4", "0"]
for inp in test_inputs:
    print(f"è¾“å…¥: {inp} -> {process_user_input(inp)}")
```

### æ•è·æ‰€æœ‰å¼‚å¸¸

```python
def risky_operation():
    """å¯èƒ½å‡ºé”™çš„æ“ä½œ"""
    try:
        # æ¨¡æ‹Ÿå¯èƒ½å‡ºé”™çš„æ“ä½œ
        data = {"name": "å¼ ä¸‰", "age": 25}
        print(data["name"])
        print(data["age"])
        # æ•…æ„åˆ¶é€ é”™è¯¯
        print(data["salary"])  # é”®ä¸å­˜åœ¨
        
    except Exception as e:
        print(f"å‘ç”Ÿé”™è¯¯: {type(e).__name__}: {e}")
        print("ç¨‹åºç»§ç»­æ‰§è¡Œ...")

risky_operation()
```

## ğŸ”„ try-except-else-finally

### å®Œæ•´çš„å¼‚å¸¸å¤„ç†ç»“æ„

```python
def file_operations(filename):
    """æ–‡ä»¶æ“ä½œç¤ºä¾‹"""
    file = None
    try:
        # å°è¯•æ‰“å¼€æ–‡ä»¶
        file = open(filename, 'r')
        content = file.read()
        print("æ–‡ä»¶è¯»å–æˆåŠŸ")
        
    except FileNotFoundError:
        print(f"é”™è¯¯ï¼šæ–‡ä»¶ {filename} ä¸å­˜åœ¨")
        
    except PermissionError:
        print(f"é”™è¯¯ï¼šæ²¡æœ‰æƒé™è®¿é—®æ–‡ä»¶ {filename}")
        
    except Exception as e:
        print(f"æœªçŸ¥é”™è¯¯ï¼š{e}")
        
    else:
        # æ²¡æœ‰å¼‚å¸¸æ—¶æ‰§è¡Œ
        print("æ–‡ä»¶æ“ä½œå®Œæˆï¼Œæ²¡æœ‰å‘ç”Ÿå¼‚å¸¸")
        return content
        
    finally:
        # æ— è®ºæ˜¯å¦å‘ç”Ÿå¼‚å¸¸éƒ½ä¼šæ‰§è¡Œ
        if file:
            file.close()
            print("æ–‡ä»¶å·²å…³é—­")

# æµ‹è¯•æ–‡ä»¶æ“ä½œ
file_operations("test.txt")
```

### å®é™…åº”ç”¨ç¤ºä¾‹

```python
def safe_json_parse(json_string):
    """å®‰å…¨è§£æJSONå­—ç¬¦ä¸²"""
    import json
    
    try:
        data = json.loads(json_string)
        print("JSONè§£ææˆåŠŸ")
        
    except json.JSONDecodeError as e:
        print(f"JSONæ ¼å¼é”™è¯¯ï¼š{e}")
        return None
        
    except Exception as e:
        print(f"å…¶ä»–é”™è¯¯ï¼š{e}")
        return None
        
    else:
        print("JSONæ•°æ®æœ‰æ•ˆ")
        return data
        
    finally:
        print("JSONè§£ææ“ä½œå®Œæˆ")

# æµ‹è¯•JSONè§£æ
valid_json = '{"name": "å¼ ä¸‰", "age": 25}'
invalid_json = '{"name": "å¼ ä¸‰", "age": 25'  # ç¼ºå°‘å³æ‹¬å·

safe_json_parse(valid_json)
print("-" * 30)
safe_json_parse(invalid_json)
```

## ğŸ¯ è‡ªå®šä¹‰å¼‚å¸¸

### åˆ›å»ºè‡ªå®šä¹‰å¼‚å¸¸

```python
class CustomError(Exception):
    """è‡ªå®šä¹‰å¼‚å¸¸åŸºç±»"""
    pass

class ValidationError(CustomError):
    """éªŒè¯é”™è¯¯"""
    def __init__(self, message, field=None):
        self.message = message
        self.field = field
        super().__init__(self.message)

class BusinessLogicError(CustomError):
    """ä¸šåŠ¡é€»è¾‘é”™è¯¯"""
    def __init__(self, message, error_code=None):
        self.message = message
        self.error_code = error_code
        super().__init__(self.message)

# ä½¿ç”¨è‡ªå®šä¹‰å¼‚å¸¸
def validate_age(age):
    """éªŒè¯å¹´é¾„"""
    if not isinstance(age, int):
        raise ValidationError("å¹´é¾„å¿…é¡»æ˜¯æ•´æ•°", "age")
    if age < 0:
        raise ValidationError("å¹´é¾„ä¸èƒ½ä¸ºè´Ÿæ•°", "age")
    if age > 150:
        raise ValidationError("å¹´é¾„ä¸èƒ½è¶…è¿‡150å²", "age")
    return True

def process_user_data(name, age):
    """å¤„ç†ç”¨æˆ·æ•°æ®"""
    try:
        validate_age(age)
        if len(name) < 2:
            raise BusinessLogicError("å§“åå¤ªçŸ­", "NAME_TOO_SHORT")
        return f"ç”¨æˆ· {name}ï¼Œå¹´é¾„ {age} éªŒè¯é€šè¿‡"
        
    except ValidationError as e:
        return f"éªŒè¯å¤±è´¥ï¼š{e.message} (å­—æ®µ: {e.field})"
        
    except BusinessLogicError as e:
        return f"ä¸šåŠ¡é€»è¾‘é”™è¯¯ï¼š{e.message} (é”™è¯¯ä»£ç : {e.error_code})"

# æµ‹è¯•è‡ªå®šä¹‰å¼‚å¸¸
print(process_user_data("å¼ ä¸‰", 25))      # æ­£å¸¸
print(process_user_data("å¼ ", 25))        # å§“åå¤ªçŸ­
print(process_user_data("å¼ ä¸‰", -5))      # å¹´é¾„ä¸ºè´Ÿ
print(process_user_data("å¼ ä¸‰", "25"))    # å¹´é¾„ç±»å‹é”™è¯¯
```

### å¼‚å¸¸é“¾

```python
class DatabaseError(Exception):
    """æ•°æ®åº“é”™è¯¯"""
    pass

class UserService:
    """ç”¨æˆ·æœåŠ¡ç±»"""
    
    def get_user(self, user_id):
        try:
            # æ¨¡æ‹Ÿæ•°æ®åº“æ“ä½œ
            if user_id < 0:
                raise DatabaseError("ç”¨æˆ·IDä¸èƒ½ä¸ºè´Ÿæ•°")
            return {"id": user_id, "name": f"ç”¨æˆ·{user_id}"}
            
        except DatabaseError as e:
            # é‡æ–°æŠ›å‡ºå¼‚å¸¸ï¼Œä¿ç•™åŸå§‹å¼‚å¸¸ä¿¡æ¯
            raise UserServiceError(f"è·å–ç”¨æˆ·å¤±è´¥: {e}") from e

class UserServiceError(Exception):
    """ç”¨æˆ·æœåŠ¡é”™è¯¯"""
    pass

# æµ‹è¯•å¼‚å¸¸é“¾
service = UserService()
try:
    user = service.get_user(-1)
except UserServiceError as e:
    print(f"ç”¨æˆ·æœåŠ¡é”™è¯¯: {e}")
    print(f"åŸå§‹é”™è¯¯: {e.__cause__}")
```

## ğŸ”§ å¼‚å¸¸å¤„ç†æœ€ä½³å®è·µ

### å…·ä½“å¼‚å¸¸å¤„ç†

```python
# å¥½çš„åšæ³•ï¼šæ•è·å…·ä½“å¼‚å¸¸
def good_practice():
    try:
        with open("config.json", "r") as f:
            config = f.read()
    except FileNotFoundError:
        print("é…ç½®æ–‡ä»¶ä¸å­˜åœ¨ï¼Œä½¿ç”¨é»˜è®¤é…ç½®")
    except PermissionError:
        print("æ²¡æœ‰æƒé™è¯»å–é…ç½®æ–‡ä»¶")
    except Exception as e:
        print(f"è¯»å–é…ç½®æ–‡ä»¶æ—¶å‘ç”ŸæœªçŸ¥é”™è¯¯: {e}")

# ä¸å¥½çš„åšæ³•ï¼šæ•è·æ‰€æœ‰å¼‚å¸¸
def bad_practice():
    try:
        with open("config.json", "r") as f:
            config = f.read()
    except:  # å¤ªå®½æ³›
        print("å‘ç”Ÿé”™è¯¯")
```

### å¼‚å¸¸å¤„ç†ä¸­çš„èµ„æºç®¡ç†

```python
class DatabaseConnection:
    """æ•°æ®åº“è¿æ¥ç±»"""
    
    def __init__(self, host, port):
        self.host = host
        self.port = port
        self.connected = False
    
    def connect(self):
        """è¿æ¥æ•°æ®åº“"""
        try:
            # æ¨¡æ‹Ÿè¿æ¥è¿‡ç¨‹
            if self.port < 0:
                raise ConnectionError("ç«¯å£å·ä¸èƒ½ä¸ºè´Ÿæ•°")
            self.connected = True
            print(f"å·²è¿æ¥åˆ° {self.host}:{self.port}")
        except ConnectionError as e:
            print(f"è¿æ¥å¤±è´¥: {e}")
            raise
    
    def disconnect(self):
        """æ–­å¼€è¿æ¥"""
        if self.connected:
            self.connected = False
            print("æ•°æ®åº“è¿æ¥å·²æ–­å¼€")
    
    def __enter__(self):
        """ä¸Šä¸‹æ–‡ç®¡ç†å™¨å…¥å£"""
        self.connect()
        return self
    
    def __exit__(self, exc_type, exc_val, exc_tb):
        """ä¸Šä¸‹æ–‡ç®¡ç†å™¨å‡ºå£"""
        self.disconnect()
        if exc_type:
            print(f"æ“ä½œè¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸: {exc_type.__name__}")
        return False  # ä¸æŠ‘åˆ¶å¼‚å¸¸

# ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨
try:
    with DatabaseConnection("localhost", 3306) as db:
        print("æ‰§è¡Œæ•°æ®åº“æ“ä½œ...")
        # æ¨¡æ‹Ÿæ“ä½œ
        if db.connected:
            print("æ“ä½œæˆåŠŸ")
except ConnectionError as e:
    print(f"æ•°æ®åº“æ“ä½œå¤±è´¥: {e}")
```

### æ—¥å¿—è®°å½•

```python
import logging

# é…ç½®æ—¥å¿—
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(levelname)s - %(message)s'
)

def process_data(data):
    """å¤„ç†æ•°æ®ï¼Œè®°å½•å¼‚å¸¸"""
    try:
        # æ¨¡æ‹Ÿæ•°æ®å¤„ç†
        if not data:
            raise ValueError("æ•°æ®ä¸èƒ½ä¸ºç©º")
        
        result = [x * 2 for x in data]
        logging.info(f"æ•°æ®å¤„ç†æˆåŠŸï¼Œå¤„ç†äº† {len(data)} æ¡è®°å½•")
        return result
        
    except ValueError as e:
        logging.error(f"æ•°æ®éªŒè¯å¤±è´¥: {e}")
        raise
        
    except Exception as e:
        logging.error(f"æ•°æ®å¤„ç†æ—¶å‘ç”ŸæœªçŸ¥é”™è¯¯: {e}")
        raise

# æµ‹è¯•æ—¥å¿—è®°å½•
try:
    result = process_data([1, 2, 3, 4, 5])
    print(f"å¤„ç†ç»“æœ: {result}")
except Exception as e:
    print(f"å¤„ç†å¤±è´¥: {e}")
```

## ğŸ¯ å®è·µç»ƒä¹ 

<div style="background: #e8f5e8; padding: 1.5rem; border-radius: 8px; margin: 2rem 0;">

### ç»ƒä¹ 1ï¼šè®¡ç®—å™¨å¼‚å¸¸å¤„ç†
ç¼–å†™ä¸€ä¸ªå®‰å…¨çš„è®¡ç®—å™¨ï¼Œå¤„ç†ä»¥ä¸‹å¼‚å¸¸ï¼š
- é™¤é›¶é”™è¯¯
- æ— æ•ˆè¾“å…¥
- æ•°å­¦è¿ç®—é”™è¯¯

### ç»ƒä¹ 2ï¼šæ–‡ä»¶å¤„ç†å¼‚å¸¸
ç¼–å†™ä¸€ä¸ªæ–‡ä»¶å¤„ç†ç¨‹åºï¼Œå¤„ç†ï¼š
- æ–‡ä»¶ä¸å­˜åœ¨
- æƒé™ä¸è¶³
- æ–‡ä»¶æ ¼å¼é”™è¯¯
- ç£ç›˜ç©ºé—´ä¸è¶³

### ç»ƒä¹ 3ï¼šç½‘ç»œè¯·æ±‚å¼‚å¸¸
æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚ï¼Œå¤„ç†ï¼š
- è¿æ¥è¶…æ—¶
- ç½‘ç»œä¸å¯è¾¾
- æœåŠ¡å™¨é”™è¯¯
- æ•°æ®æ ¼å¼é”™è¯¯

### ç»ƒä¹ 4ï¼šç”¨æˆ·è¾“å…¥éªŒè¯
åˆ›å»ºä¸€ä¸ªç”¨æˆ·æ³¨å†Œç³»ç»Ÿï¼ŒéªŒè¯ï¼š
- ç”¨æˆ·åæ ¼å¼
- å¯†ç å¼ºåº¦
- é‚®ç®±æ ¼å¼
- å¹´é¾„èŒƒå›´

</div>

## ğŸ” è°ƒè¯•æŠ€å·§

### å¼‚å¸¸ä¿¡æ¯åˆ†æ

```python
import traceback

def analyze_exception():
    """åˆ†æå¼‚å¸¸ä¿¡æ¯"""
    try:
        # æ•…æ„åˆ¶é€ ä¸€ä¸ªå¤æ‚çš„å¼‚å¸¸
        data = {"users": [{"name": "å¼ ä¸‰", "age": 25}]}
        user = data["users"][1]  # ç´¢å¼•è¶…å‡ºèŒƒå›´
        print(user["salary"])    # é”®ä¸å­˜åœ¨
        
    except Exception as e:
        print(f"å¼‚å¸¸ç±»å‹: {type(e).__name__}")
        print(f"å¼‚å¸¸ä¿¡æ¯: {e}")
        print(f"å¼‚å¸¸å‚æ•°: {e.args}")
        print("\nå®Œæ•´å¼‚å¸¸ä¿¡æ¯:")
        traceback.print_exc()

analyze_exception()
```

### å¼‚å¸¸å¤„ç†è£…é¥°å™¨

```python
def handle_exceptions(func):
    """å¼‚å¸¸å¤„ç†è£…é¥°å™¨"""
    def wrapper(*args, **kwargs):
        try:
            return func(*args, **kwargs)
        except Exception as e:
            print(f"å‡½æ•° {func.__name__} å‘ç”Ÿå¼‚å¸¸: {e}")
            return None
    return wrapper

@handle_exceptions
def risky_function(x, y):
    """å¯èƒ½å‡ºé”™çš„å‡½æ•°"""
    return x / y

# ä½¿ç”¨è£…é¥°å™¨
result = risky_function(10, 0)
print(f"ç»“æœ: {result}")
```

## ğŸ“Š å¼‚å¸¸å¤„ç†æ€»ç»“

<div style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px; margin: 2rem 0;">

### å¼‚å¸¸å¤„ç†åŸåˆ™

1. **å…·ä½“ä¼˜äºå®½æ³›**ï¼šæ•è·å…·ä½“å¼‚å¸¸è€Œä¸æ˜¯æ‰€æœ‰å¼‚å¸¸
2. **æ—©å‘ç°æ—©å¤„ç†**ï¼šåœ¨é—®é¢˜å‘ç”Ÿçš„åœ°æ–¹å¤„ç†å¼‚å¸¸
3. **æä¾›æœ‰ç”¨ä¿¡æ¯**ï¼šå¼‚å¸¸ä¿¡æ¯åº”è¯¥å¸®åŠ©å®šä½é—®é¢˜
4. **ä¼˜é›…é™çº§**ï¼šæä¾›å¤‡ç”¨æ–¹æ¡ˆæˆ–é»˜è®¤å€¼
5. **è®°å½•æ—¥å¿—**ï¼šè®°å½•å¼‚å¸¸ä¿¡æ¯ç”¨äºè°ƒè¯•
6. **èµ„æºæ¸…ç†**ï¼šä½¿ç”¨ finally æˆ–ä¸Šä¸‹æ–‡ç®¡ç†å™¨æ¸…ç†èµ„æº

### å¸¸è§å¼‚å¸¸ç±»å‹

| å¼‚å¸¸ç±»å‹ | æè¿° | å¸¸è§åœºæ™¯ |
|----------|------|----------|
| ValueError | å€¼é”™è¯¯ | ç±»å‹è½¬æ¢å¤±è´¥ |
| TypeError | ç±»å‹é”™è¯¯ | æ“ä½œä¸æ”¯æŒçš„ç±»å‹ |
| IndexError | ç´¢å¼•é”™è¯¯ | åˆ—è¡¨ç´¢å¼•è¶…å‡ºèŒƒå›´ |
| KeyError | é”®é”™è¯¯ | å­—å…¸é”®ä¸å­˜åœ¨ |
| FileNotFoundError | æ–‡ä»¶ä¸å­˜åœ¨ | æ‰“å¼€ä¸å­˜åœ¨çš„æ–‡ä»¶ |
| ZeroDivisionError | é™¤é›¶é”™è¯¯ | é™¤æ•°ä¸ºé›¶ |

</div>

## ä¸‹ä¸€æ­¥

ç°åœ¨ä½ å·²ç»æŒæ¡äº† Python çš„å¼‚å¸¸å¤„ç†ï¼Œæ¥ä¸‹æ¥å­¦ä¹ ï¼š

- [æ–‡ä»¶æ“ä½œ](/python/07-æ–‡ä»¶æ“ä½œ.md) - å­¦ä¹ æ–‡ä»¶è¯»å†™æ“ä½œ
- [å®è·µé¡¹ç›®](/python/08-å®è·µé¡¹ç›®.md) - ç»¼åˆåº”ç”¨æ‰€å­¦çŸ¥è¯†

---

<div style="text-align: center; margin-top: 2rem;">
  <p>ğŸ’¡ <strong>å­¦ä¹ å»ºè®®</strong>ï¼šå¤šç»ƒä¹ å¼‚å¸¸å¤„ç†ï¼Œæé«˜ç¨‹åºçš„å¥å£®æ€§å’Œç”¨æˆ·ä½“éªŒ</p>
</div>
