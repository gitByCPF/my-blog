# ğŸŒ åˆ†å¸ƒå¼ä¸å¾®æœåŠ¡

## åˆ†å¸ƒå¼ç³»ç»Ÿæ¦‚è¿°

åˆ†å¸ƒå¼ç³»ç»Ÿæ˜¯ç”±å¤šä¸ªç‹¬ç«‹çš„è®¡ç®—æœºç»„æˆçš„ç³»ç»Ÿï¼Œé€šè¿‡ç½‘ç»œé€šä¿¡åè°ƒå·¥ä½œã€‚

```
æ ¸å¿ƒæŒ‘æˆ˜ï¼šç½‘ç»œä¸å¯é ã€æ—¶é’Ÿä¸ä¸€è‡´ã€åˆ†åŒºä¸å»¶è¿Ÿã€æœ€ç»ˆä¸€è‡´æ€§ã€å¯è§‚æµ‹æ€§
```

## å¾®æœåŠ¡æ¶æ„

### å¾®æœåŠ¡ç‰¹ç‚¹

- **ç‹¬ç«‹éƒ¨ç½²**ï¼šæ¯ä¸ªæœåŠ¡å¯ä»¥ç‹¬ç«‹éƒ¨ç½²
- **æŠ€æœ¯å¼‚æ„**ï¼šå¯ä»¥ä½¿ç”¨ä¸åŒçš„æŠ€æœ¯æ ˆ
- **æœåŠ¡æ²»ç†**ï¼šæœåŠ¡æ³¨å†Œã€å‘ç°ã€é…ç½®ç®¡ç†

### Spring Cloud

```java
// æœåŠ¡æ³¨å†Œ
@SpringBootApplication
@EnableEurekaClient
public class UserServiceApplication {
    public static void main(String[] args) {
        SpringApplication.run(UserServiceApplication.class, args);
    }
}

// æœåŠ¡è°ƒç”¨
@RestController
public class UserController {
    @Autowired
    private RestTemplate restTemplate;
    
    @GetMapping("/users/{id}")
    public User getUser(@PathVariable Long id) {
        return restTemplate.getForObject("http://user-service/users/" + id, User.class);
    }
}
```

## åˆ†å¸ƒå¼äº‹åŠ¡

### ä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰

- å‡†å¤‡é˜¶æ®µ
- æäº¤é˜¶æ®µ

### Saga æ¨¡å¼

- è¡¥å¿äº‹åŠ¡
- åˆ†å¸ƒå¼é”

```
Saga ç¼–æ’ï¼ˆå›¾ç¤ºï¼‰ï¼š
OrderCreated â†’ ReserveStock â†’ CreatePayment â†’ Confirm â†’
è‹¥å¤±è´¥ï¼šCancelPayment â†’ ReleaseStock â†’ MarkOrderCanceled
```

```java
// äº‹åŠ¡æ¶ˆæ¯ï¼ˆä¼ªä»£ç ï¼‰
@Transactional
public void createOrder(){
  orderRepo.save(PENDING);
  mq.send("order.created", orderId); // å¤±è´¥åˆ™å›æ»š
}
```

## æœåŠ¡æ²»ç†ä¸è§‚æµ‹

### é…ç½®ã€æ³¨å†Œã€ç†”æ–­ã€é™æµ

```
æ³¨å†Œå‘ç°ï¼ˆEureka/Nacos/Consulï¼‰
é…ç½®ä¸­å¿ƒï¼ˆSpring Cloud Configï¼‰
ç†”æ–­/éš”ç¦»ï¼ˆResilience4jï¼šè¶…æ—¶/é‡è¯•/æ–­è·¯/èˆ±å£ï¼‰
é™æµï¼ˆç½‘å…³/æœåŠ¡ç«¯ï¼‰
```

```java
@Retry(name = "remoteA")
@CircuitBreaker(name = "remoteA")
public User callRemote(){ /* ... */ }
```

### æ—¥å¿—/æŒ‡æ ‡/è¿½è¸ªï¼ˆå¯è§‚æµ‹æ€§ä¸‰ä»¶å¥—ï¼‰

```
æ—¥å¿—ï¼šç»“æ„åŒ–ï¼ŒTraceId è´¯ç©¿
æŒ‡æ ‡ï¼šQPSã€P95ã€é”™è¯¯ç‡ã€ä¾èµ–æˆåŠŸç‡
è¿½è¸ªï¼šOpenTelemetry/Zipkinï¼Œç½‘å…³æ³¨å…¥ B3/W3C Trace Context
```

## API ç½‘å…³ä¸å®‰å…¨

```
å®¢æˆ·ç«¯ â†’ API ç½‘å…³ï¼ˆè®¤è¯/é™æµ/è·¯ç”±/èšåˆï¼‰â†’ å„å¾®æœåŠ¡
```

```yaml
# Spring Cloud Gateway ç‰‡æ®µ
routes:
  - id: order
    uri: http://order-service
    predicates: [ Path=/api/orders/** ]
    filters: [ StripPrefix=1 ]
```

## å­˜å‚¨ä¸ç¼“å­˜

```
å…³ç³»åº“ï¼ˆå¼ºä¸€è‡´ï¼‰ + ç¼“å­˜ï¼ˆè¯»å¤šå†™å°‘ï¼‰ + æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆè§£è€¦/å‰Šå³°ï¼‰
ç¼“å­˜å¤±æ•ˆç­–ç•¥ï¼šæ—è·¯/å†™ç©¿/å†™å›ï¼›é˜²å‡»ç©¿/ç©¿é€/é›ªå´©
```

## éƒ¨ç½²ä¸å¼¹æ€§

```
å®¹å™¨åŒ– + ç¼–æ’ï¼ˆK8sï¼‰
æ»šåŠ¨å‡çº§/é‡‘ä¸é›€/è“ç»¿
HPAï¼šåŸºäº CPU/QPS/è‡ªå®šä¹‰æŒ‡æ ‡æ‰©ç¼©å®¹
```

## ä¸‹ä¸€æ­¥

æŒæ¡äº†åˆ†å¸ƒå¼ä¸å¾®æœåŠ¡åï¼Œå¯ä»¥ç»§ç»­å­¦ä¹ ï¼š

- [Java é¢è¯•ä¸å·¥ç¨‹èƒ½åŠ›](/java/32-Javaé¢è¯•ä¸å·¥ç¨‹èƒ½åŠ›.md) - æå‡é¢è¯•èƒ½åŠ›

---

<div style="text-align: center; margin-top: 2rem;">
  <p>ğŸ’¡ <strong>æç¤º</strong>ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿå¼€å‘éœ€è¦æŒæ¡æœåŠ¡æ²»ç†ã€åˆ†å¸ƒå¼äº‹åŠ¡ã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰æŠ€æœ¯</p>
</div>
